## 통합 테스트란?

- 두 개 이상의 모듈이 상호 작용하여 발생하는 상태를 검증하는 테스트이다.
  -> 단위 테스트에 비해 모킹의 비중이 적고, 모듈 간 발생하는 에러 검증이 가능하다.
- 실제 앱의 비즈니스 로직과 유사하게 기능을 검증할 수 있다.
  -> 컴포넌트가 특정 비즈니스 로직을 올바르게 수행하는지 검증 가능하다.
- 주로, 컴포넌트 간의 상호작용, API 호출, 상태 변경에 따른 UI 변경 사항 검증한다.

- 테스트 항목
  - **상태 기준**으로 동작하는 컴포넌트 조합
  - **API 기반**으로 상호작용 하는 컴포넌트 조합
  - **단순 UI 렌더링** 및 **간단한 로직**을 실행하는 컴포넌트 조합

<br/>

### 단위 vs 통합 테스트

- 통합 테스트에서 단위 테스트 항목도 테스트할 수 있다.
- 그래서 통합 테스트 작성시, 단위 테스트는 생략할 수 있다.

|             | ProductCard(단위)                                                                                                                                          | ProductList(통합)                                                                                                                                                                                                                                                                                                   |
| ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 역할        | - 단일 상품을 보여줌                                                                                                                                       | - 상품 리스트를 보여줌                                                                                                                                                                                                                                                                                              |
| 테스트 항목 | - prop 기준으로 가격, 상품명이 제대로 렌더링 되는지<br/>- 상품 클릭시 상세화면으로 이동하는지<br/>- 장바구니, 구매 버튼을 눌렀을 때 각 핸들러가 호출되는지 | - 조회 API 기준으로 가격·상품명이 제대로 렌더링되는지<br/>- 상품 클릭시 상세화면으로 이동하는지<br/>- 장바구니, 구매 버튼을 눌렀을 때<br/>→ 로그인: 상품 추가 후 장바구니로 이동<br/>→ 비로그인: 로그인 페이지로 이동<br/><br/>- 상품 리스트가 더 있는 경우 더보기 버튼이 노출되며, 버튼 클릭시 데이터를 호출하는지 |

<br/>

### 통합 테스트와 좋은 설계의 관계

- 만약, 상태, 데이터를 관리하는 컴포넌트 기준으로 하위 컴포넌트가 제대로 렌더링 되는지 검증하는 경우에는...
- 데이터를 관리하는 로직이 산재되어 있다면, 통합 테스트 작성이 어렵다.
- 즉, 통합 테스트를 잘 작성하기 위해 좋은 설계가 기반이 되어야 한다.

<br/>

## 통합 테스트와 모킹

- 모킹은 테스트를 독립적으로 분리하여 효과적으로 검증할 수 있게 도와준다.
- 하지만, 많은 모킹은 테스트 신뢰성을 저하시키며 변경에 취약하게 만든다.
- 그래서, 거대한 통합 테스트는 모킹 코드가 증가하고 변경에도 취약해 테스트 신뢰도를 낮출 수 있다.
- 통합 테스트 작성시, 비즈니즈 로직을 파악하고 영역별로 나눠 테스트하는 게 좋다.

<br/>

## 통합 테스트와 비즈니즈 로직

### 비즈니즈 로직이란?

- 프로그램의 핵심 기능을 구현하는 코드이다.
- 사용자가 원하는 결과를 얻기 위해, 계산, 처리, 의사 결정을 수행하는 코드이다.
- 비즈니스 로직으로, 서비스의 정책, 절차, 규칙 등을 코드로 구현한다.

<br/>

> 쇼핑몰 메인 페이지를 기준으로 생각해보자면, 메인 페이지의 비즈니즈 로직은...

- 네비게이션 영역의 로그인 여부에 따른 동작
- API 기반으로 필터의 카테고리 데이터를 올바르게 렌더링 하는지
- 필터 항목을 수정했을 때 올바르게 반영되는지 검증
- API 응답에 따라 상품 리스트가 적절하게 렌더링 되는지

<br/>

### 비즈니스 로직 기준으로 통합테스트를 작성시 장점

- 서비스의 핵심 비즈니스 로직을 독립적인 기능 관점에서 검증할 수 있다.
- 테스트가 곧 명세가 되기에, 서비스를 이해하는데 도움이 된다.
- 불필요한 단위 테스트를 줄여 유지 보수하기 좋다.
- 이때 비즈니즈 로직을 여러 영역으로 나눠, 검증하는 게 좋다.
  - 각 비즈니스 로직에서 중요한 기능 검증하기
  - 각 영역 별로 필요한 부분만 모킹하기

<br/>

> 메인 페이지의 비즈니스 로직을 영역 단위로 나눠보면...

- 네비게이션 바 영역: 사용자 로그인 여부에 따른 UI 렌더링 및 상호작용(로그인, 로그아웃
- 상품 검색 영역: 필터 요소에 따른 검색 조건 설정
- 상품 리스트 영역: 검색 결과에 따른 상품 리스트 렌더링 및 버튼 클릭에 따른 상호작용

<br/>

### 통합 테스트 범위 선정시 주의할 점

> 1.  가능한 한 모킹을 하지 않고 앱의 실 기능과 유사하게 검증하기

> 2. 비즈니스 로직을 처리하는 상태 관리나 API 로직은 상위 컴포넌트로 응집해 관리하기

- 하위 컴포넌트에서 각각 사용자의 상태를 조회하지 않고, 상위 컴포넌트에서 상태를 관리해야한다.

> 3. 여러 도메인 기능이 조합된 비즈니스 로직은 나눠 통합 테스트 작성하기

- 여러 도메인의 기능을 하나의 테스트에서 관리시 변경에 취약해진다.
- 예를 들어, 메인 홈 페이지에 대한 통합 테스트 작성시, 하나의 테스트를 작성하지 말고,
- 사용자 로그인 + 상품 검색 + 상품 리스트 영역으로 나눠서 테스트 해야한다.
