### 단위 테스트 전략

- state나 로직처리 없이 UI만 그리는 컴포넌트는 검증하지 않는다.
- UI만 그리는 컴포넌트의 검증은 스토리북 도구를 통해 검증한다.
- 간단한 로직 처리만 하는 컴포넌트는 상위 컴포넌트의 통합 테스트에서 검증한다.
- 공통 유틸 함수는 단위 테스트로 검증한다.
- 다른 모듈과의 의존성의 없어야 한다.
- 여러 곳에서 사용되는 경우 검증을 통해 안정성을 높여야 한다.

<br/>

### 외부 라이브러리도 검증해야할까?

> useNavigate를 검증해야 할까?

- useNavigate()에 대한 추가 검증은 불필요하다.
- 왜냐하면, useNavigate()의 경우, 라이브러리 자체에서 테스트를 하고 있기 때문이다.
- 그래서, 외부 모듈에 대한 검증은 분리하고 모듈의 특정 기능을 **제대로 호출하는지만 검증**해야한다.
- 모듈이 호출되는지 검증하는 방법은 모킹(`Mocking`)이 있다.

<br/>

### 모킹이란?

- 실제 모듈 • 객체와 동일한 동작을 하도록 만들어진 객체이다.
- 외부 모듈의 호출을 검증할 수 있다.
- `vi.mock()`을 사용해 특정 모듈을 모킹할 수 있다.
- 단, 실제 모듈과 완전히 동일한 모의 객체를 구현하는 것은 큰 비용이다.
- 또한, 모의 객체를 남용하는 것은 테스트 신뢰성을 낮춘다.

```js
/**
 * 테스트를 위한 사전 모킹
 * 1. spy함수를 사용해, useNavigate 훅으로 반환받은 navigate 함수가 올바르게 호출되는지 확인
 * 2. react-router-dom 모듈을 모킹하여 useNavigate 훅을 spy함수로 대체
 * */

const navigateFn = vi.fn();

vi.mock('react-router-dom', async () => {
  const original = await vi.importActual('react-router-dom');
  return {
    ...original,
    useNavigate: () => navigateFn,
  };
});
```

<br/>

### 모킹 초기화가 필요한 이유!

> 다른 테스트에서는 특정 모듈에 대한 모킹이 필요없는데, 모킹 중이라면?
> 특정 테스트의 모킹 작업이 다른 테스트에 영향을 준다면?

- 테스트의 신뢰성을 떨어뜨릴 수 있으므로 모킹 초기화가 필요하다!
- 테스트를 실행한 뒤에는 명시적으로 모킹 초기화를 하자!
- `setupTest.js`에서 전역으로 초기화하는 방법도 있다.

  ex) `clearAllMocks`, `resetAllMocks`

| clearAllMocks                                                                                                                                                                                                    | resetAllMocks                                                               |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- |
| - 모킹된 모의 객체 호출에 대한 히스토리를 초기화<br/>- 단, 모듈의 모킹은 유지됨<br/>-모킹 모듈 기반으로 작성된 테스트 코드를 작성할 때 유용<br/>- 반면, 모킹 히스토리가 쌓이므로 다른 테스트에 영향을 줄 수 있음 | - 모킹 모듈에 대한 모든 구현을 초기화<br/>- 테스트의 안전성과 신뢰성을 보장 |

```js
// setupTest.js
afterEach(() => {
  vi.clearAllMocks();
});

afterAll(() => {
  vi.resetAllMocks();
});
```
